!function(e){if("object"==typeof module&&"object"==typeof module.exports){var t=e(require,exports);void 0!==t&&(module.exports=t)}else"function"==typeof define&&define.amd&&define(["require","exports","./types.js"],e)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e("./types.js"),o=document.getElementById("config-input"),a=document.getElementById("save-button"),r=document.getElementById("calendar-container"),c=document.getElementById("timezone-select"),l=document.getElementById("color-picker-modal"),s=l.querySelector(".close"),i=document.getElementById("color-input"),d=document.getElementById("apply-color");let m=null;function u(){l.style.display="none"}function p(e,t){return luxon.DateTime.fromISO(e,{zone:t}).startOf("day").toJSDate()}function f(e,t,o,a){const r=document.createElement("table");r.className="month-table";const c=document.createElement("thead"),l=document.createElement("tr");l.className="month-name-row";const s=document.createElement("th");s.colSpan=7,s.textContent=`${n.MONTH_NAMES[t]} ${e}`,l.appendChild(s),c.appendChild(l);const i=document.createElement("tr");i.className="weekday-row";const d=["Su","Mo","Tu","We","Th","Fr","Sa"];for(const e of d){const t=document.createElement("th");t.textContent=e,i.appendChild(t)}c.appendChild(i),r.appendChild(c);const m=document.createElement("tbody"),u=new Date(e,t,1).getDay(),p=new Date(e,t+1,0).getDate(),f=u+p,g=Math.ceil(f/7);let y=1;for(let n=0;n<g;n++){const r=document.createElement("tr");for(let c=0;c<7;c++){const l=document.createElement("td");if(7*n+c>=u&&y<=p){l.textContent=y.toString();const n=new Date(e,t,y);n.setHours(0,0,0,0);const r=[];for(let e=0;e<o.length;e++){const t=o[e];if(t.startDate&&t.endDate)n>=t.startDate&&n<=t.endDate&&(r.push(t.color),a.add(e));else if(t.dateObjects)for(const o of t.dateObjects)n.getTime()===o.getTime()&&(r.push(t.color),a.add(e))}r.length>0&&(l.style.background=h(r)),y++}else l.textContent="";r.appendChild(l)}m.appendChild(r)}return r.appendChild(m),r}function h(e){const t=100/e.length;return`linear-gradient(to bottom, ${e.map(((e,n)=>`${e} ${t*n}%, ${e} ${t*(n+1)}%`)).join(", ")})`}function g(){const e=new URLSearchParams(window.location.search).get("config");if(e)try{const t=LZString.decompressFromEncodedURIComponent(e);return function(e){try{const t=`[${e}]`,n=JSON.parse(t),o={};return n[0]&&(o.years=n[0].map((e=>e+2024))),n[1]&&(o.highlightPeriods=n[1].map((e=>{if(Array.isArray(e)){if("number"==typeof e[0]&&"number"==typeof e[1]){const t=1e5*e[0],n=new Date(t).toISOString().split("T")[0]||"",o=e[1],a={start:n,end:new Date(t+24*o*60*60*1e3).toISOString().split("T")[0]||"",color:e[2]};return e[3]&&(a.label=e[3]),a}if(Array.isArray(e[0])){const t=1e5*e[0][0],n=e[0].slice(1),o=[new Date(t).toISOString().split("T")[0]||""];n.forEach((e=>{const t=new Date(new Date(o[o.length-1]).getTime()+864e5*e);o.push(t.toISOString().split("T")[0]||"")}));const a={dates:o,color:e[1]};return e[2]&&(a.label=e[2]),a}{const t={dates:[new Date(1e5*e[0]).toISOString().split("T")[0]||""],color:e[1]};return e[2]&&(t.label=e[2]),t}}return e}))),n[2]&&(o.timezone=n[2]),jsyaml.dump(o)}catch(e){return console.error("Error decompressing JSON:",e),null}}(t)}catch(e){alert(`Error decoding configuration from URL: ${e.message}`)}return null}function y(e){const t=function(e){try{const t=jsyaml.load(e),n=[[],[]];if(t.years){const e=t.years.map((e=>e-2024));n[0]=e}if(t.highlightPeriods){const e=t.highlightPeriods.map((e=>{if(e.start&&e.end&&e.color){const t=Math.floor(new Date(e.start).getTime()/1e5),n=new Date(e.start),o=new Date(e.end),a=[t,Math.ceil((o.getTime()-n.getTime())/864e5),e.color];return e.label&&a.push(e.label),a}if(e.dates&&e.color){const t=e.dates.map((e=>Math.floor(new Date(e).getTime()/1e5))).sort(((e,t)=>e-t));if(1===t.length){const n=[t[0],e.color];return e.label&&n.push(e.label),n}{const n=t[0],o=t.slice(1).map((e=>(e-n)/864)),a=[[n,...o],e.color];return e.label&&a.push(e.label),a}}return e}));n[1]=e}return t.timezone&&"auto"!==t.timezone&&(n[2]=t.timezone),JSON.stringify(n).slice(1,-1)}catch(e){return console.error("Error compressing YAML:",e),null}}(e);if(t){const e=LZString.compressToEncodedURIComponent(t),n=`${window.location.protocol}//${window.location.host}${window.location.pathname}?config=${e}`;window.history.replaceState({path:n},"",n)}}o.addEventListener("keydown",(e=>{"#"===e.key&&setTimeout((()=>{m=o.selectionStart-1,l.style.display="block",i.focus()}),0)})),s.addEventListener("click",u),window.addEventListener("click",(e=>{e.target===l&&u()})),d.addEventListener("click",(()=>{const e=i.value;null!==m&&function(e){const t=o.value,n=t.slice(0,m),a=t.slice(m+1),r=n+e+a;o.value=r;const c=n.length+e.length;o.selectionStart=c,o.selectionEnd=c,o.focus(),m=null}(e),u()})),a.addEventListener("click",(()=>{const e=o.value;try{const t=jsyaml.load(e),o=t.years,a=t.highlightPeriods,l=function(){const e=c.value;return"auto"===e?luxon.DateTime.local().zoneName:e}();if(!Array.isArray(o)||!Array.isArray(a))throw new Error("Invalid configuration format.");!function(e,t,o){r.innerHTML="";const a=t.map(((e,t)=>{const n={...e,order:t};return e.start&&(n.startDate=p(e.start,o)),e.end&&(n.endDate=p(e.end,o)),e.dates&&(n.dateObjects=e.dates.map((e=>p(e,o)))),n}));for(const t of e){const e=document.createElement("div");e.className="calendar";const o=document.createElement("h2");o.textContent=t.toString(),e.appendChild(o);const c=new Set,l=document.createElement("table");l.className="year-table";const s=document.createElement("tbody");for(const e of n.MONTH_ROWS){const n=document.createElement("tr");for(const o of e){const e=document.createElement("td");e.appendChild(f(t,o,a,c)),n.appendChild(e)}s.appendChild(n)}l.appendChild(s),e.appendChild(l);const i=Array.from(c).map((e=>a[e])).filter((e=>e.label));if(i.length>0){const t=document.createElement("div");t.className="legend";for(const e of i){const n=document.createElement("div");n.className="legend-item";const o=document.createElement("div");o.className="legend-color",o.style.backgroundColor=e.color;const a=document.createElement("span");a.textContent=e.label,n.appendChild(o),n.appendChild(a),t.appendChild(n)}e.appendChild(t)}r.appendChild(e)}}(o,a,l);const s={...t,timezone:l};y(jsyaml.dump(s))}catch(e){alert(`Error parsing configuration: ${e.message}`)}})),function(){const e=g();if(e){o.value=e;try{const t=jsyaml.load(e);t.timezone&&(c.value=t.timezone)}catch(e){}}else{const e=(new Date).getFullYear();o.value=`years:\n  - ${e}\nhighlightPeriods:\n  - start: '${e}-12-01'\n    end: '${e}-12-31'\n    color: '#ffd700'  # gold\n    label: 'Festival Break'\n  - dates:\n      - '${e}-01-13'\n    color: '#ff6b6b'  # coral red\n    label: 'Important Day'\n`}a.click()}()}));